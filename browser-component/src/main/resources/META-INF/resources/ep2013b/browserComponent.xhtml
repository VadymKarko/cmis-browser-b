<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:cc="http://java.sun.com/jsf/composite"
      xmlns:p="http://primefaces.org/ui">

<cc:interface>
    <cc:attribute name="link"/>
    <cc:attribute name="controller"
                  type="com.engagepoint.university.ep2013b.browser.component.controller.BrowserController"/>
</cc:interface>

<cc:implementation>


<h:outputText value="#{cc.attrs.controller.currentLocation}"/>

<p:growl id="messages" showDetail="true"/>

<p/>
<h:messages style="height: 11px;color: mediumvioletred; font-family: monospace;" id="info"/>
<p/>


<h:panelGrid id="seniorpanel" columns="2" >
<h:column style="width: 200px;" >

    <p:contextMenu id="treeContextMenu" for="tree">
        <p:menuitem id="contextItemNewFolder" value="Create folder"
                    update=":#{cc.clientId}:seniorpanel"
                    actionListener="#{cc.attrs.controller.showPanel(1)}"
                    icon="ui-icon-search"/>
        <p:menuitem id="contextItemEdit" value="Edit folder"
                    update=":#{cc.clientId}:seniorpanel"
                    actionListener="#{cc.attrs.controller.showPanel(2)}"
                    icon="ui-icon-search"/>
        <p:menuitem id="contextItemView" value="View folder"
                    update=":#{cc.clientId}:seniorpanel"
                    actionListener="#{cc.attrs.controller.displaySelectedSingle}"
                    icon="ui-icon-search"/>
        <p:menuitem id="contextItemDelete" value="Delete folder"
                    update=":#{cc.clientId}:seniorpanel"
                    onclick="confirmDeleteDialog.show()"
                    icon="ui-icon-close"/>
    </p:contextMenu>

    <p:tree id="tree" value="#{cc.attrs.controller.root}" var="node" selectionMode="single"
            selection="#{cc.attrs.controller.selectedNode}"
            dynamic="true">

        <p:treeNode id="node" expandedIcon="ui-icon-folder-open"
                    collapsedIcon="ui-icon-folder-collapsed">
            <h:outputLink value="#{cc.attrs.link}" id="treelink">
                <h:outputText value="#{node.name}"/>
                <f:param name="folderId" value="#{node.id}"/>
            </h:outputLink>

        </p:treeNode>
    </p:tree>
</h:column>


<h:column style="width: 850px;">
    <!-- Simple Search -->
    <p:panel rendered="#{!cc.attrs.controller.isShowEditFolderPanel()}">
        <p:tabView id="tabView" style="height: 250px; width: 840px;">

            <p:tab id="tab1" title="Simple search">
                <h:panelGrid columns="3">
                    <p:inputText id="searchInput" value="#{cc.attrs.controller.searchCriteria}"/>

                    <p:commandButton id="searchbtn" action="#{cc.attrs.controller.simple}"
                                     update=":#{cc.clientId}:table"
                                     icon="ui-icon-search" title="Search">
                        <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
                    </p:commandButton>

                    <p:ajaxStatus>
                        <f:facet name="start">
                            <h:outputText value="  processing..."/>
                        </f:facet>

                        <f:facet name="complete">
                            <h:outputText value=""/>
                        </f:facet>
                    </p:ajaxStatus>

                </h:panelGrid>
            </p:tab>
            <p:tab id="tab2" title="Advanced search">

                <h:panelGrid columns="4">
                    <h:outputLabel value="Document type:" style="width: 80px; text-align: right;"  />
                    <!-- WARNING: Should be PrimeFace component <p:selectOneMenu>,
                                  but it sets itemLabel to documentType instead of itemValue-->
                    <h:selectOneMenu id="searchDocumentType"
                                     value="#{cc.attrs.controller.advancedSearchParams.documentType}">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="Document" itemValue="cmis:document"/>
                        <f:selectItem itemLabel="Folder" itemValue="cmis:folder"/>
                    </h:selectOneMenu>

                    <h:outputLabel value="Content type:" style="width: 80px; text-align: right;" />
                    <h:selectOneMenu id="searchContentType"
                                     value="#{cc.attrs.controller.advancedSearchParams.contentType}">
                        <f:selectItem itemLabel="" itemValue=""/>
                        <f:selectItem itemLabel="Complex Type" itemValue="ComplexType"/>
                    </h:selectOneMenu>

                    <h:outputLabel value="Date from:" style="width: 80px; text-align: right;" />
                    <p:calendar id="searchDateFrom" showOn="button"
                                value="#{cc.attrs.controller.advancedSearchParams.dateFrom}"
                                style="width: 80px;"/>

                    <h:outputLabel value="Date to:" style="width: 80px; text-align: right;" />
                    <p:calendar id="searchDateTo" showOn="button"
                                value="#{cc.attrs.controller.advancedSearchParams.dateTo}"
                            style="width: 80px;"/>


                    <h:outputLabel value="Size (B):" style="width: 80px; text-align: right;" />
                    <p:spinner id="searchSize" value="#{cc.attrs.controller.advancedSearchParams.size}"/>

                    <h:outputLabel value="Text in content:" style="width: 80px; text-align: right;" />
                    <p:inputText id="searchText" value="#{cc.attrs.controller.advancedSearchParams.text}"/>

                    <h:outputText value="" style="width: 80px; text-align: right;"  />
                    <p:commandButton id="advsearchbtn" action="#{cc.attrs.controller.simple}"
                                     update=":#{cc.clientId}:table"
                                     value=" Advanced search"
                                     icon="ui-icon-search"
                                     title="Advanced search"  >
                        <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
                    </p:commandButton>
                    <p:ajaxStatus>
                        <f:facet name="start">
                            <h:outputText value="processing..."  style="color: blueviolet;" />
                        </f:facet>

                        <f:facet name="complete">
                            <h:outputText value=""/>
                        </f:facet>
                    </p:ajaxStatus>
                </h:panelGrid>
            </p:tab>
        </p:tabView>

        <!-- button : "New Folder"-->
        <p:commandButton id="createfolder" action="#{cc.attrs.controller.showPanel(1)}" immediate="true"
                         value="New Folder" update=":#{cc.clientId}:seniorpanel" title="Create new Folder">

            <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
        </p:commandButton>

        <p:commandButton id="editfolder" action="#{cc.attrs.controller.showPanel(2)}" immediate="true"
                         value="Edit Folder" update=":#{cc.clientId}:seniorpanel" title="Edit folder">

            <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
        </p:commandButton>
        <p:commandButton id="deletefolder"
                         value="Delete folder"
                         type="button"
                         onclick="confirmDeleteDialog.show()"
                         immediate="true"/>




        <h:outputText value="" style="height: 20px;" />

        <!-- Table Panel-->
        <p:dataTable var="item" value="#{cc.attrs.controller.dataList}" id="table" style="width: 840px;" >
            <p:column headerText="Id">
                <h:outputText value="#{item.id}" id="itemid"/>
            </p:column>

            <p:column headerText="Name">
                <h:outputText value="#{item.name}" id="itemname"/>
            </p:column>

            <p:column headerText="Type">
                <h:outputText value="#{item.type}" id="itemtype"/>
            </p:column>

            <p:column headerText="Creation Date">
                <h:outputText value="#{item.created}" id="itemcreated"/>
            </p:column>

            <!-- Paging Panel-->
            <f:facet name="footer">
                <p:commandButton id="butfirst" action="#{cc.attrs.controller.firstPage}"
                                 disabled="#{!cc.attrs.controller.prevAllowed}"
                                 update=":#{cc.clientId}:table"
                                 icon="ui-icon-arrowthickstop-1-w">
                    <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
                </p:commandButton>

                <p:commandButton id="butprev" action="#{cc.attrs.controller.prevPage}"
                                 disabled="#{!cc.attrs.controller.prevAllowed}"
                                 update=":#{cc.clientId}:table"
                                 icon="ui-icon-arrowthick-1-w">
                    <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
                </p:commandButton>

                <p:commandButton id="butnext" action="#{cc.attrs.controller.nextPage}"
                                 disabled="#{!cc.attrs.controller.nextAllowed}"
                                 update=":#{cc.clientId}:table"
                                 icon="ui-icon-arrowthick-1-e">
                    <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
                </p:commandButton>

                <p:commandButton id="butlast" action="#{cc.attrs.controller.lastPage}"
                                 disabled="#{!cc.attrs.controller.nextAllowed}"
                                 update=":#{cc.clientId}:table"
                                 icon="ui-icon-arrowthickstop-1-e">
                    <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
                </p:commandButton>
            </f:facet>
        </p:dataTable>
    </p:panel>


    <p:panel id="panel" style="margin-bottom:10px; width: 400px;"
             rendered="#{cc.attrs.controller.isShowEditFolderPanel()}">

        <h:panelGrid columns="3">
            <h:outputLabel for="namefolder" value="Name: * "
                           rendered="#{cc.attrs.controller.operationFlag ne 3}" />
            <p:inputText id="namefolder" required="true" label="Name"
                         value="#{cc.attrs.controller.newFolderItem.name}"
                         requiredMessage="Missing folder name!!!"
                         rendered="#{cc.attrs.controller.operationFlag ne 3}"/>
            <h:message for="namefolder" rendered="#{cc.attrs.controller.operationFlag ne 3}" />


            <h:outputLabel for="type" value="Type: * "
                           rendered="#{cc.attrs.controller.operationFlag ne 3}" />
            <!-- SHOULD BE TYPE INSTEAD OF ID!!! -->
            <h:selectOneMenu id="type" value="#{cc.attrs.controller.newFolderItem.id}"
                             rendered="#{cc.attrs.controller.operationFlag ne 3}">
                <f:selectItem itemLabel="Folder" itemValue="cmis:folder"/>
                <f:selectItem itemLabel="Document" itemValue="cmis:document"/>
            </h:selectOneMenu>
            <h:message for="type" rendered="#{cc.attrs.controller.operationFlag ne 3}" />

            <p:commandButton id="savefolderbtn"
                             action="#{cc.attrs.controller.createFolder(cc.attrs.link)}"
                             value="Save" ajax="false"
                             update=":#{cc.clientId}:seniorpanel"
                             title="Create new folder"
                             rendered="#{cc.attrs.controller.operationFlag eq 1}">

                <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
            </p:commandButton>

            <p:commandButton id="editfolderbtn"
                             action="#{cc.attrs.controller.editFolder(cc.attrs.link)}"
                             value="Edit" ajax="false"
                             update=":#{cc.clientId}:seniorpanel"
                             title="Edit folder"
                             rendered="#{cc.attrs.controller.operationFlag eq 2}">

                <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
            </p:commandButton>


            <p:commandButton id="cancel" action="#{cc.attrs.controller.hidePanel()}" value="Cancel"
                             update=":#{cc.clientId}:seniorpanel" immediate="true"/>

        </h:panelGrid>
    </p:panel>


</h:column>
</h:panelGrid>
<p:confirmDialog message="Are you sure about deleting the folder?"
        id="confirmDeleteDialog" widgetVar="confirmDeleteDialog">
    <p:commandButton id="deletefolderbtn1"
                     actionListener="#{cc.attrs.controller.deleteFolder(cc.attrs.link)}"
                     value="Delete"
                     immediate="true"

                     title="Delete folder"  >
        <f:param name="folderId" value="#{cc.attrs.controller.folderId}"/>
    </p:commandButton>
    <p:commandButton id="cancel1"
                     value="Cancel"
                     onclick="confirmDeleteDialog.hide()"
                     update=":#{cc.clientId}:seniorpanel"
                     immediate="true"/>

</p:confirmDialog>

</cc:implementation>

</html>